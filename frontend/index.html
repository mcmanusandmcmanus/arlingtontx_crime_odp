<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arlington East Crime - CompStat Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script>
</head>
<body data-api-base="http://localhost:8000">
<div class="layout">
    <header>
        <h1>Arlington East District CompStat</h1>
        <p>Real-time situational awareness built on Arlington open data. Overview cards stay mission-critical while supporting tabs let you drill into time patterns, beats, offense mix, and cases.</p>
    </header>

    <nav class="tabs">
        <button class="tab-button active" data-target="overview">Overview</button>
        <button class="tab-button" data-target="time-tempo">Time &amp; Tempo</button>
        <button class="tab-button" data-target="beats">Beats &amp; Areas</button>
        <button class="tab-button" data-target="offense">Crime Types &amp; Violence</button>
        <button class="tab-button" data-target="cases">Case Intelligence</button>
    </nav>

    <section class="card config-card">
        <h2>API Endpoint</h2>
        <p class="muted">Point the dashboard at your Render FastAPI service (saved locally, no backend changes required).</p>
        <form id="apiConfigForm" class="api-config">
            <input type="url" id="apiBaseInput" placeholder="https://arlington-compstat-api.onrender.com" />
            <button type="submit">Update &amp; Reload</button>
        </form>
        <small id="apiStatusMessage"></small>
    </section>

    <section id="overview" class="tab-section active">
        <div class="hero" id="kpiCards">
            <div class="card">
                <h3>Total Incidents (YTD)</h3>
                <div class="value" id="totalIncidents">--</div>
                <p id="coverageRange"></p>
            </div>
            <div class="card">
                <h3>7-Day Change</h3>
                <div class="value" id="sevenDayCount">--</div>
                <div class="pill" id="sevenDayChange">--</div>
            </div>
            <div class="card">
                <h3>28-Day Change</h3>
                <div class="value" id="twentyEightDayCount">--</div>
                <div class="pill" id="twentyEightDayChange">--</div>
            </div>
            <div class="card">
                <h3>Forecast Next 7 Days</h3>
                <div class="value" id="forecastTotal">--</div>
                <p id="forecastDetail"></p>
            </div>
        </div>

        <section class="card chart">
            <h2>Daily Incident Trend</h2>
            <svg id="trendChart"></svg>
        </section>

        <div class="section-grid">
            <div class="card">
                <h2>CompStat Table</h2>
                <table id="compstatTable">
                    <thead>
                    <tr>
                        <th>Window</th>
                        <th>Count</th>
                        <th>vs Prior</th>
                        <th>YoY</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="card chart">
                <h2>Crime Category Mix</h2>
                <svg id="categoryChart"></svg>
            </div>
        </div>

        <section class="card">
            <h2>Random Forest Forecast (7 days)</h2>
            <div id="forecastList"></div>
        </section>
    </section>

    <section id="time-tempo" class="tab-section">
        <div class="section-grid">
            <div class="card chart">
                <h2>Hour-of-Day Rhythm</h2>
                <svg id="hourBarChart"></svg>
            </div>
            <div class="card chart">
                <h2>Day vs Hour Heatmap</h2>
                <svg id="dayHourHeatmap"></svg>
            </div>
        </div>
    </section>

    <section id="beats" class="tab-section">
        <div class="section-grid">
            <div class="card chart">
                <h2>Beat Workload</h2>
                <svg id="beatBarChart"></svg>
            </div>
            <div class="card chart">
                <h2>Beat vs Hour Intensity</h2>
                <svg id="beatHourHeatmap"></svg>
            </div>
        </div>
    </section>

    <section id="offense" class="tab-section">
        <div class="section-grid">
            <div class="card chart">
                <h2>Category Trend (Weekly)</h2>
                <svg id="categoryStackedArea"></svg>
            </div>
            <div class="card chart">
                <h2>Violent vs Non-Violent Mix</h2>
                <svg id="violenceDonut"></svg>
            </div>
        </div>
    </section>

    <section id="cases" class="tab-section">
        <div class="card">
            <h2>Case Intelligence Search</h2>
            <form id="caseSearchForm" class="case-search">
                <input type="text" id="caseQuery" placeholder="Case number or keyword (e.g., ROBBERY, 2024-0319)">
                <button type="submit">Search</button>
            </form>
            <div id="caseResults" class="case-results"></div>
        </div>
    </section>
</div>

<script src="js/app.js"></script>
</body>
</html>
